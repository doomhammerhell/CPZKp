# Playground Example

This example demonstrates an interactive playground for experimenting with CPZKp.

## Project Structure

```
playground/
├── Cargo.toml
├── index.html
├── src/
│   ├── lib.rs
│   └── utils.rs
└── style.css
```

## Implementation

### 1. Cargo.toml

```toml
[package]
name = "cpzkp-playground"
version = "0.1.0"
edition = "2021"

[lib]
crate-type = ["cdylib", "rlib"]

[dependencies]
cpzkp = { path = "../../..", features = ["wasm"] }
js-sys = "0.3"
monaco = { git = "https://github.com/rustwasm/monaco" }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
wasm-bindgen = "0.2"
web-sys = { version = "0.3", features = [
    "Document",
    "Element",
    "HtmlElement",
    "Window",
    "console",
]}
```

### 2. lib.rs

```rust
use wasm_bindgen::prelude::*;
use web_sys::{Document, Element, HtmlElement, Window};
use monaco::api::CodeEditor;
use cpzkp::{KeyPair, Proof};
use serde_json::{json, to_string_pretty};

#[wasm_bindgen]
pub struct Playground {
    editor: CodeEditor,
    keypair: Option<KeyPair>,
    proof: Option<Proof>,
}

#[wasm_bindgen]
impl Playground {
    #[wasm_bindgen(constructor)]
    pub fn new() -> Self {
        let window = web_sys::window().unwrap();
        let document = window.document().unwrap();
        let editor_div = document.create_element("div").unwrap();
        editor_div.set_id("editor");
        document.body().unwrap().append_child(&editor_div).unwrap();

        let editor = CodeEditor::create(
            &editor_div,
            &json!({
                "value": "// Enter your JSON here\n{\n  \"group\": \"scalar\",\n  \"message\": \"Hello, World!\"\n}",
                "language": "json",
                "theme": "vs-dark",
                "automaticLayout": true,
            }),
        );

        Self {
            editor,
            keypair: None,
            proof: None,
        }
    }

    #[wasm_bindgen]
    pub fn generate_keypair(&mut self) -> Result<String, JsValue> {
        let content = self.editor.get_value();
        let input: serde_json::Value = serde_json::from_str(&content)
            .map_err(|e| JsValue::from_str(&e.to_string()))?;

        let group = input["group"]
            .as_str()
            .ok_or_else(|| JsValue::from_str("Missing group type"))?;

        self.keypair = Some(KeyPair::new(group)
            .map_err(|e| JsValue::from_str(&e.to_string()))?);

        let json = self.keypair.as_ref().unwrap().to_json()
            .map_err(|e| JsValue::from_str(&e.to_string()))?;

        Ok(to_string_pretty(&json).unwrap())
    }

    #[wasm_bindgen]
    pub fn generate_proof(&mut self) -> Result<String, JsValue> {
        let content = self.editor.get_value();
        let input: serde_json::Value = serde_json::from_str(&content)
            .map_err(|e| JsValue::from_str(&e.to_string()))?;

        let message = input["message"]
            .as_str()
            .ok_or_else(|| JsValue::from_str("Missing message"))?;

        if let Some(keypair) = &self.keypair {
            self.proof = Some(Proof::generate(keypair, message)
                .map_err(|e| JsValue::from_str(&e.to_string()))?);

            let json = self.proof.as_ref().unwrap().to_json()
                .map_err(|e| JsValue::from_str(&e.to_string()))?;

            Ok(to_string_pretty(&json).unwrap())
        } else {
            Err(JsValue::from_str("Generate a keypair first"))
        }
    }

    #[wasm_bindgen]
    pub fn verify_proof(&self) -> Result<bool, JsValue> {
        if let Some(proof) = &self.proof {
            proof.verify()
                .map_err(|e| JsValue::from_str(&e.to_string()))
        } else {
            Err(JsValue::from_str("Generate a proof first"))
        }
    }
}
```

### 3. index.html

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CPZKp Playground</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .editor-container {
            flex: 1;
            margin-bottom: 20px;
        }
        #editor {
            height: 400px;
            border: 1px solid #ccc;
        }
        .buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        .output {
            flex: 1;
            border: 1px solid #ccc;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CPZKp Playground</h1>
        <div class="editor-container">
            <div id="editor"></div>
        </div>
        <div class="buttons">
            <button onclick="generateKeypair()">Generate Keypair</button>
            <button onclick="generateProof()">Generate Proof</button>
            <button onclick="verifyProof()">Verify Proof</button>
        </div>
        <div class="output" id="output"></div>
    </div>
    <script type="module">
        import init, { Playground } from './pkg/cpzkp_playground.js';
        await init();
        window.playground = new Playground();
    </script>
    <script>
        function generateKeypair() {
            try {
                const result = playground.generate_keypair();
                document.getElementById('output').textContent = result;
            } catch (e) {
                document.getElementById('output').textContent = `Error: ${e}`;
            }
        }

        function generateProof() {
            try {
                const result = playground.generate_proof();
                document.getElementById('output').textContent = result;
            } catch (e) {
                document.getElementById('output').textContent = `Error: ${e}`;
            }
        }

        function verifyProof() {
            try {
                const result = playground.verify_proof();
                document.getElementById('output').textContent = `Verification: ${result}`;
            } catch (e) {
                document.getElementById('output').textContent = `Error: ${e}`;
            }
        }
    </script>
</body>
</html>
```

## Building and Running

### 1. Build the Project

```bash
wasm-pack build --target web
```

### 2. Serve the Application

```bash
python3 -m http.server
```

### 3. Access the Playground

Open your browser and navigate to `http://localhost:8000`

## Features

1. Interactive code editor
2. Keypair generation
3. Proof generation
4. Proof verification
5. JSON input/output
6. Error handling

## Usage Examples

### 1. Generate Keypair

```json
{
    "group": "scalar"
}
```

### 2. Generate Proof

```json
{
    "group": "scalar",
    "message": "Hello, World!"
}
```

## Security Considerations

1. Input validation
2. Error handling
3. Secure random number generation
4. Proper error messages

## Best Practices

1. Use appropriate error handling
2. Validate user input
3. Provide clear feedback
4. Test thoroughly
5. Consider performance 